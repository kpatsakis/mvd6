static void pgstat_beshutdown_hook(int code,Datum arg) if ( ( bool ) ( MyDatabaseId != ( ( Oid ) 0 ) ) )  pgstat_report_stat ( ( ( bool ) 1 ) ); void pgstat_report_stat(bool force) static const PgStat_TableCounts all_zeroes ; static TimestampTz last_report = 0 ; TimestampTz now ; PgStat_MsgTabstat regular_msg ; PgStat_MsgTabstat shared_msg ; TabStatusArray * tsa ; int i ; if ( ( pgStatTabList == ( ( void * ) 0 ) || pgStatTabList -> tsa_used == 0 ) && ! have_function_stats && ! force )  now = GetCurrentTransactionStopTimestamp ( ); if ( ! force && ! TimestampDifferenceExceeds ( last_report , now , 500 ) )  regular_msg . m_databaseid = MyDatabaseId; shared_msg . m_databaseid = ( ( Oid ) 0 ); regular_msg . m_nentries = 0; shared_msg . m_nentries = 0; for (tsa = pgStatTabList; tsa != ((void *)0); tsa = tsa -> tsa_next) for (i = 0; i < tsa -> tsa_used; i++) PgStat_TableStatus * entry = & tsa -> tsa_entries [ i ] ; PgStat_MsgTabstat * this_msg ; PgStat_TableEntry * this_ent ; if ( memcmp ( ( & entry -> t_counts ) , ( & all_zeroes ) , sizeof ( PgStat_TableCounts ) ) == 0 )  this_msg = ( entry -> t_shared ? & shared_msg : & regular_msg ); this_ent = & this_msg -> m_entry [ this_msg -> m_nentries ]; this_ent -> t_id = entry -> t_id; memcpy ( ( & this_ent -> t_counts ) , ( & entry -> t_counts ) , sizeof ( PgStat_TableCounts ) ); if ( ( ++ this_msg -> m_nentries ) >= ( 1000 - sizeof ( PgStat_MsgHdr ) - sizeof ( Oid ) - 3 * sizeof ( int ) ) / sizeof ( PgStat_TableEntry ) )  this_msg -> m_nentries = 0; tsa -> tsa_used = 0; 