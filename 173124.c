static int CVE_2014_5272_PATCHED_decode_frame(AVCodecContext void *data, int AVPacket *avpkt) IffContext * s = avctx -> priv_data ; int y , plane , res ; if ( ( res = extract_header ( avctx , avpkt ) ) < 0 )  if ( s -> init )  if ( ( res = avctx -> reget_buffer ( avctx , & s -> frame ) ) < 0 )  if ( ( res = ff_get_buffer ( avctx , & s -> frame ) ) < 0 )  if ( avctx -> bits_per_coded_sample <= 8 && avctx -> pix_fmt == AV_PIX_FMT_PAL8 )  if ( ( res = cmap_read_palette ( avctx , ( uint32_t * ) s -> frame . data [ 1 ] ) ) < 0 )  if ( avctx -> pix_fmt == AV_PIX_FMT_RGB32 && avctx -> bits_per_coded_sample <= 8 )  if ( ( res = cmap_read_palette ( avctx , s -> mask_palbuf ) ) < 0 )  s -> init = 1; switch ( s -> compression )  if ( avctx -> codec_tag == MKTAG ( 'I' , 'L' , 'B' , 'M' ) )  if ( avctx -> pix_fmt == AV_PIX_FMT_PAL8 || avctx -> pix_fmt == AV_PIX_FMT_GRAY8 )  if ( avctx -> bits_per_coded_sample <= 8 )  if ( s -> ham )  for(y = 0; y < avctx->height ; y++ ) uint8_t * row = & s -> frame . data [ 0 ] [ y * s -> frame . linesize [ 0 ] ] ; memset ( row , 0 , avctx -> width << 2 ); decodeplane32 ( ( uint32_t * ) row , s -> planebuf , s -> planesize , plane ); 